<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Job Form</title>
  <link rel="stylesheet" href="form_style.css">
</head>

<body>


<!-- 
  <div class="backbtn">
    <button><a href="form.html">back</a></button>
  </div> -->


  <div id="processingIndicator" class="modal">
    <div class="pro-content">
      <h2>Processing...</h2>
      <p>Please wait while we submit your data.</p>
    </div>
  </div>


      
  <div id="submissionError" class="fail_error" style="display: none;">
    <h1>Form submission encountered an error. <br> Please try again later.</h1>
  </div>
  



  <div id="successMessage" class="modal">
    <div class="modal-content">

      <div class="modalbox">
        <div class="modaltxt">
          <h2>Form Submission Successful</h2>
          <h4>Thank you for submitting the form. Here are the details you entered:</h4>
        </div>
        <div id="submittedData">
          <!-- Submitted data will be displayed here -->
        </div>
        <button id="okayButton">Okay</button>
      </div>
    </div>
  </div>


  <!-- <video id="background-video" autoplay loop muted poster="bg.mp4">
    <source src="bg.mp4" type="video/mp4">
    </video> -->
  <!-- <h1 class="jobform"></h1> -->
  <div class="jobform">
    <button><a href="form.html"><span>âžœ</span>back</a></button>
  </div>
  <form method="post" id="form">

    <!-- <div class="reciept_no">
      <h3>receipt no</h3>
      <label for="receiptNo"></label>
      <input type="text" id="receiptNo" name="receiptNo" readonly>
    </div> -->




    <div class="sec_a">
      <div class="dropdown">
        <h3>job user</h3>
        <input name="jobuser" type="text" placeholder="job user" id="searchInput1" autocomplete="off">
        <div class="dropdown-content">
          <a href="#">AJEET SHARMA</a>
          <a href="#">AMAN GOYAL</a>
          <a href="#">AMAN GANGIL</a>
          <a href="#">IBRAHIM GOURI</a>
          <a href="#">GOVIND GARG</a>
          <a href="#">MEGHA CHANDIL</a>
          <a href="#">NANCY GARG </a>
          <a href="#">NISHANT SHARMA</a>
          <a href="#">PANKAJ BANSAL</a>
          <a href="#">RIYA GOYAL</a>
          <a href="#">SAKSHI BANSAL</a>
          <a href="#">SOURABH GARG</a>
        </div>
      </div>


      <div class="mode">
        <h3>job receiving mode</h3>
        <div class="button-group">
          <input name="job_receiving_mode" type="radio" id="mode1" value="PHONE">
          <label for="mode1">BY PHONE</label>

          <input name="job_receiving_mode" type="radio" id="mode2" value="PERSON">
          <label for="mode2">BY PERSON</label>

          <input name="job_receiving_mode" type="radio" id="mode3" value="TEAM">
          <label for="mode3">BY TEAM</label>
        </div>
      </div>
    </div>



    <div id="modeError" class="error-message" style="display: none;">
      Please select a job receiving mode.
    </div>
    <div id="userAssignedError" class="error-message" style="display: none;">
      Job User and Assigned By cannot be the same.
    </div>
    <div id="droperror" class="error-message" style="display: none;">
      Please select valid values from the dropdown lists for Job User and Work Type.
    </div>
    <div id="assignedByerror" class="error-message" style="display: none;">
      Please select the team member name from ASSIGNED BY.
    </div>

    <div id="teamAssignmentAlert" class="error-message" style="display: none;">
      Assigned by is mandatory when BY TEAM is selected.
    </div>

    <div id="assignedByError" class="error-message" style="display: none;">
      Please select a valid name from the ASSIGNED BY dropdown.
    </div>

    <div id="paymentError" class="error-message" style="display: none;">
      Please select a valid payment status from the dropdown list.
    </div>







    <div id="assignedByFieldContainer">
      <div class="dropdown" id="assignedByField">
        <h3>assigned by</h3>
        <input name="assignby" type="text" placeholder="assigned by" id="searchInput2" autocomplete="off">
        <div class="dropdown-content">
          <a href="#">AJEET SHARMA</a>
          <a href="#">AMAN GOYAL</a>
          <a href="#">AMAN GANGIL</a>
          <a href="#">IBRAHIM GOURI</a>
          <a href="#">GOVIND GARG</a>
          <!-- <a href="#">MEGHA CHANDIL</a> -->
          <a href="#">NANCY GARG</a>
          <a href="#">NISHANT SHARMA</a>
          <a href="#">PANKAJ BANSAL</a>
          <!-- <a href="#">RIYA GOYAL</a> -->
          <!-- <a href="#">SAKSHI BANSAL</a> -->
          <a href="#">SOURABH GARG</a>
          <a href="#">SOURABH AGRAWAL</a>
          <a href="#">PRAKASH AGRAWAL</a>
        </div>
      </div>
    </div>

    <div class="p_detail">
      <div class="sec_b">
        <div class="dropdownwt">
          <h3>work type</h3>
          <input name="worktype" type="text" placeholder="work type" id="searchInput3" autocomplete="off">
          <div class="dropdown-content">

            <a href="#">BANKING</a>
            <a href="#">ACCOUNTING</a>
            <a href="#">REGISTRATION</a>
            <a href="#">CERTIFICATION</a>
            <a href="#">AUDIT</a>
            <a href="#">ITR</a>
            <a href="#">GST</a>
            <a href="#">TDS</a>
            <a href="#">SUBSIDY</a>
            <a href="#">OTHER</a>
          </div>
        </div>

        <div class="p_nm">
          <h3>party name</h3>
          <input type="text" id="partyName" name="partyName" placeholder="party Name" autocomplete="off" required>
        </div>

        <div class="pay">
          <div class="dropdownpay">
            <input name="payment" type="text" placeholder="payment STATUS" id="searchInput4" autocomplete="off">
            <div class="dropdown-content">
              <a href="#">A/C FOR</a>
              <a href="#">PAYMENT DONE</a>
            </div>
          </div>
          <input type="number" id="fees" name="fees" step="1" placeholder="fees" autocomplete="off">
        </div>


      </div>

      <div class="d_fee">
        <div class="disc">
          <h3>work Discription</h3>
          <textarea placeholder="work Discription" id="workDescription" name="workDescription" rows="4" cols="50"
            required></textarea>
        </div>
        <input type="text" id="time" name="time" style="display: none;" readonly>
      </div>
    </div>

    <div class="sub">
      <input type="submit" id="submitButton" value="Submit">

    </div>
  </form>
</body>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get references to all three search inputs and dropdown contents
    const searchInput1 = document.getElementById("searchInput1");
    const searchInput2 = document.getElementById("searchInput2");
    const searchInput3 = document.getElementById("searchInput3");
    const searchInput4 = document.getElementById("searchInput4");
    const dropdownContent1 = document.querySelectorAll(".dropdown-content")[0];
    const dropdownContent2 = document.querySelectorAll(".dropdown-content")[1];
    const dropdownContent3 = document.querySelectorAll(".dropdown-content")[2];
    const dropdownContent4 = document.querySelectorAll(".dropdown-content")[3];



    // Function to handle the keydown event
    function handleKeyDown(event) {
      const successModal = document.getElementById('successMessage');
      const okayButton = document.getElementById('okayButton');

      if (event.key === 'Enter' && successModal.style.display === 'block') {
        // Prevent the default behavior of the Enter key
        event.preventDefault();

        // Trigger a click on the "Okay" button
        okayButton.click();
      }
    }

    // Add a keydown event listener to the document body
    document.body.addEventListener('keydown', handleKeyDown);

    // Function to handle dropdown behavior
    function handleDropdown(searchInput, dropdownContent) {
      // Show the dropdown when the input field is focused
      searchInput.addEventListener("focus", function () {
        dropdownContent.classList.add("show");
      });

      // Hide the dropdown when the input field loses focus
      searchInput.addEventListener("blur", function () {
        setTimeout(function () {
          dropdownContent.classList.remove("show");
        }, 200);
      });

      // Filter options based on user input in real-time
      searchInput.addEventListener("input", function () {
        const searchTerm = searchInput.value.toLowerCase();
        const options = dropdownContent.querySelectorAll("a");

        options.forEach(function (option) {
          const text = option.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            option.style.display = "inline-block";
          } else {
            option.style.display = "none";
          }
        });

        // Show/hide the dropdown based on whether there are matching options
        if (dropdownContent.querySelector("a[style='display: inline-block;']")) {
          dropdownContent.classList.add("show");
        } else {
          dropdownContent.classList.remove("show");
        }
      });

      // Handle option selection
      dropdownContent.addEventListener("click", function (e) {
        if (e.target.tagName === "A") {
          searchInput.value = e.target.textContent;
          dropdownContent.classList.remove("show");
        }
      });
    }

    // Call the function for each dropdown
    handleDropdown(searchInput1, dropdownContent1);
    handleDropdown(searchInput2, dropdownContent2);
    handleDropdown(searchInput3, dropdownContent3);
    handleDropdown(searchInput4, dropdownContent4);
  });

  const jobReceivingModeInputs = document.querySelectorAll('input[name="job_receiving_mode"]');
  const assignedByField = document.getElementById('assignedByField');
  const form = document.querySelector('#form');
  const jobUserDropdown = document.querySelector('#searchInput1');
  const assignedByDropdown = document.querySelector('#searchInput2');
  const workTypeDropdown = document.querySelector('#searchInput3');
  const payment = document.querySelector('#searchInput4');

  const url = "https://script.google.com/macros/s/AKfycbyoOK6jttxt_RH4K5Sy0FArblaywYeMvNpYUMKiuW050hawzFoqZyCjaw745fvnnFSgFQ/exec";


  function updateAssignedByFieldVisibility() {
    const mode3RadioButton = document.getElementById('mode3');
    const assignedByFieldContainer = document.getElementById('assignedByFieldContainer');

    if (mode3RadioButton.checked) {
      assignedByFieldContainer.style.display = 'block';
    } else {
      assignedByFieldContainer.style.display = 'none';
    }
  }

  // Call the updateAssignedByFieldVisibility function when the page loads
  document.addEventListener("DOMContentLoaded", function () {
    updateAssignedByFieldVisibility();
  });

  // Add a change event listener to the radio buttons to update visibility
  jobReceivingModeInputs.forEach(function (input) {
    input.addEventListener("change", updateAssignedByFieldVisibility);
  });
 // Function to validate form submission
async function validateFormSubmission() {
  const selectedJobUser = jobUserDropdown.value;
  const selectedAssignedBy = assignedByDropdown.value;
  const selectedWorkType = workTypeDropdown.value;

  // Check if one of the radio buttons is selected
  const mode1RadioButton = document.getElementById('mode1');
  const mode2RadioButton = document.getElementById('mode2');
  const mode3RadioButton = document.getElementById('mode3');
  const isModeSelected = mode1RadioButton.checked || mode2RadioButton.checked || mode3RadioButton.checked;

  if (!isModeSelected) {
    // Display the error message for mode selection
    const modeError = document.getElementById('modeError');
    modeError.style.display = 'block';
    modeError.scrollIntoView({ behavior: "smooth" });
    return false;
  } else {
    // Hide the error message for mode selection if a mode is selected
    const modeError = document.getElementById('modeError');
    modeError.style.display = 'none';
  }

  // Check if Job User and Assigned By are the same
  if (selectedJobUser === selectedAssignedBy) {
    // Display the error message for both being the same
    const userAssignedError = document.getElementById('userAssignedError');
    userAssignedError.style.display = 'block';
    userAssignedError.scrollIntoView({ behavior: "smooth" });
    return false;
  } else {
    // Hide the error message for both being the same if they are not the same
    const userAssignedError = document.getElementById('userAssignedError');
    userAssignedError.style.display = 'none';
  }

  // Check if "BY TEAM" is selected and the "Assigned by" field is empty
  if (mode3RadioButton.checked && selectedAssignedBy.trim() === '') {
    // Show the alert message for team assignment
    const teamAssignmentAlert = document.getElementById('teamAssignmentAlert');
    teamAssignmentAlert.style.display = 'block';
    teamAssignmentAlert.scrollIntoView({ behavior: "smooth" });
    return false;
  } else {
    // Hide the alert message for team assignment if conditions are met
    const teamAssignmentAlert = document.getElementById('teamAssignmentAlert');
    teamAssignmentAlert.style.display = 'none';
  }

  // Check if "BY TEAM" is selected and the value in "Assigned by" field is not in the dropdown list
  if (mode3RadioButton.checked && !isValueInDropdown(selectedAssignedBy, document.querySelectorAll(".dropdown-content")[1])) {
    // Show the error message for invalid assigned by value
    const assignedByError = document.getElementById('assignedByError');
    assignedByError.style.display = 'block';
    assignedByError.scrollIntoView({ behavior: "smooth" });
    return false;
  } else {
    // Hide the error message for invalid assigned by value if it is valid
    const assignedByError = document.getElementById('assignedByError');
    assignedByError.style.display = 'none';
  }

  if (
    !isValueInDropdown(selectedJobUser, document.querySelectorAll(".dropdown-content")[0]) ||
    !isValueInDropdown(selectedWorkType, document.querySelectorAll(".dropdown-content")[2])
  ) {
    // Display the error message for both being the same
    const droperror = document.getElementById('droperror');
    droperror.style.display = 'block';
    droperror.scrollIntoView({ behavior: "smooth" });
    return false;
  } else {
    // Hide the error message for both being the same if they are not the same
    const userAssignedError = document.getElementById('userAssignedError');
    userAssignedError.style.display = 'none';
  }

  const searchInput4 = document.getElementById('searchInput4');
  const paymentDropdownContent = document.querySelectorAll(".dropdown-content")[3];

  const selectedPayment = searchInput4.value.trim();
  const isPaymentInDropdown = isValueInDropdown(selectedPayment, paymentDropdownContent);

  if (!isPaymentInDropdown) {
    // Display an error message for invalid payment
    const paymentError = document.getElementById('paymentError');
    paymentError.style.display = 'block';
    paymentError.scrollIntoView({ behavior: "smooth" });
    return false;
  } else {
    // Hide the error message for invalid payment if it is valid
    const paymentError = document.getElementById('paymentError');
    paymentError.style.display = 'none';
  }

  return true;
}

  // Function to validate if a value is in the dropdown list
  function isValueInDropdown(value, dropdownContent) {
    const options = dropdownContent.querySelectorAll("a");
    for (let option of options) {
      if (option.textContent.toLowerCase() === value.toLowerCase()) {
        return true;
      }
    }
    return false;
  }

  // Function to reset the form
  function resetForm() {
    form.reset(); // Reset the form element
    // Reset any additional fields or elements as needed
  }

  // Function to show the processing indicator
  function showProcessingIndicator() {
    const processingIndicator = document.getElementById('processingIndicator');
    processingIndicator.style.display = 'block';
  }

  // Function to hide the processing indicator
  function hideProcessingIndicator() {
    const processingIndicator = document.getElementById('processingIndicator');
    processingIndicator.style.display = 'none';
  }

  // Function to display the success message modal
  function displaySuccessModal(formData) {
    const successModal = document.getElementById('successMessage');
    const submittedDataContainer = document.getElementById('submittedData');

    // Populate the submitted data container with the form data
    submittedDataContainer.innerHTML = formData;

    // Display the success modal
    successModal.style.display = 'block';

    const okayButton = document.getElementById('okayButton');
    okayButton.addEventListener('click', function () {
      successModal.style.display = 'none';

      // Reset the form
      location.reload();

    });
  }

  // Function to get the submitted form data for display
  function getSubmittedFormData(formData) {
    const submittedData = [];

    for (const pair of formData.entries()) {
      submittedData.push(`<p><strong>${pair[0]}:</strong> ${pair[1]}</p>`);
    }

    return submittedData.join('');
  }




  // Function to disable the submit button
function disableSubmitButton() {
  const submitButton = document.getElementById('submitButton');
  submitButton.disabled = true;
}

// Function to enable the submit button
function enableSubmitButton() {
  const submitButton = document.getElementById('submitButton');
  submitButton.disabled = false;
}



  form.addEventListener("submit", async (e) => {
  e.preventDefault();
  disableSubmitButton(); // Disable the submit button when the form is submitted
  if (await validateFormSubmission()) {
    // Check if the "Assigned by" field is mandatory when "BY TEAM" is selected
    const mode3RadioButton = document.getElementById('mode3');
    const assignedByInput = document.querySelector('#searchInput2');

    showProcessingIndicator(); // Show the processing indicator while submitting

    // Capture the current date and time
    const currentDateTime = new Date().toLocaleString();

    // Set the current date and time as the value of the "time" field
    document.getElementById('time').value = currentDateTime;

    const formData = new FormData(form);
    try {
      const response = await fetch(url, {
        method: "POST",
        body: formData,
      });

      if (response.ok) {
        const result = await response.text();
        console.log(result);

        // Hide the processing indicator once the submission is complete
        hideProcessingIndicator();

        // Display success message with submitted data
        displaySuccessModal(getSubmittedFormData(formData));
      } else {
        // Handle HTTP errors (e.g., 404, 500, etc.)
        throw new Error(`HTTP Error: ${response.status} ${response.statusText}`);
      }
    } catch (error) {
      console.error("Error:", error);

      // Hide the processing indicator in case of an error
      hideProcessingIndicator();

      // Display the form submission error in the HTML
      const submissionError = document.getElementById('submissionError');
      submissionError.style.display = 'flex';
    }
    
     // Enable the submit button after form submission is complete
     enableSubmitButton();
  } else {
    // If validation fails, enable the submit button to allow for corrections
    enableSubmitButton();
  }
});






  // Add a click event listener to the document body to hide the mode error message
  function hideModeError() {
    const modeError = document.getElementById('modeError');
    modeError.style.display = 'none';
  }
  document.body.addEventListener('click', hideModeError);
  // Add a click event listener to the document body to hide the userAssignedError message
  function hideUserAssignedError() {
    const userAssignedError = document.getElementById('userAssignedError');
    userAssignedError.style.display = 'none';
  }
  document.body.addEventListener('click', hideUserAssignedError);
  // Add a click event listener to the document body to hide the userAssignedError message
  function droperror() {
    const droperror = document.getElementById('droperror');
    droperror.style.display = 'none';
  }
  document.body.addEventListener('click', droperror);

  function hideteamAssignmentAlert() {
    const teamAssignmentAlert = document.getElementById('teamAssignmentAlert');
    teamAssignmentAlert.style.display = 'none';
  }
  document.body.addEventListener('click', hideteamAssignmentAlert);

  function hideassignedByError() {  
    const assignedByError = document.getElementById('assignedByError');
    assignedByError.style.display = 'none';
  }
  document.body.addEventListener('click', hideassignedByError);

  function hidepaymentError() {
    const paymentError = document.getElementById('paymentError');
    paymentError.style.display = 'none';
  }
  document.body.addEventListener('click', hidepaymentError);

// Function to hide the submission error with animation and refresh the page
function hidesubmissionErrorAndRefresh() {
  const submissionError = document.getElementById('submissionError');
  if (submissionError.style.display === 'flex') {
    submissionError.style.animation = 'slideOut 0.3s ease-in-out'; // Use the slideOut animation
    setTimeout(() => {
      submissionError.style.display = 'none'; // Hide the error message after the animation
      submissionError.style.animation = ''; // Reset the animation
      location.reload(); // Refresh the page
    }, 300); // Wait for the animation duration (300 milliseconds) before hiding and refreshing
  }
}

document.body.addEventListener('click', hidesubmissionErrorAndRefresh);


</script>
